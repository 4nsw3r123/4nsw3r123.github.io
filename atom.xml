<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>4nsw3r&#39;s Blog</title>
  <icon>https://www.gravatar.com/avatar/8d2526d3abd4e05e8e5d09f817fee41d</icon>
  
  <link href="https://4nsw3r.top/atom.xml" rel="self"/>
  
  <link href="https://4nsw3r.top/"/>
  <updated>2021-08-05T16:59:03.054Z</updated>
  <id>https://4nsw3r.top/</id>
  
  <author>
    <name>4nsw3r</name>
    <email>2239888030@qq.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>对 SEH 的浅显认识</title>
    <link href="https://4nsw3r.top/2021/08/04/%E5%AF%B9%20SEH%20%E7%9A%84%E6%B5%85%E6%98%BE%E8%AE%A4%E8%AF%86/"/>
    <id>https://4nsw3r.top/2021/08/04/%E5%AF%B9%20SEH%20%E7%9A%84%E6%B5%85%E6%98%BE%E8%AE%A4%E8%AF%86/</id>
    <published>2021-08-04T15:45:36.386Z</published>
    <updated>2021-08-05T16:59:03.054Z</updated>
    
    <content type="html"><![CDATA[<h1 id="对-SEH-的浅显认识"><a href="#对-SEH-的浅显认识" class="headerlink" title="对 SEH 的浅显认识"></a>对 SEH 的浅显认识</h1><p>SEH 是 Windows 操作系统提供的异常处理机制。</p><h2 id="使用-try-关键字注册-SEH"><a href="#使用-try-关键字注册-SEH" class="headerlink" title="使用 __try 关键字注册 SEH"></a>使用 __try 关键字注册 SEH</h2><p>使用 __try 关键字可以创建 SEH：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">FilterFunc</span><span class="params">(DWORD dwExceptionCode)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dwExceptionCode == EXCEPTION_ACCESS_VIOLATION)<span class="comment">//非法访问异常</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SEH catch\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> EXCEPTION_EXECUTE_HANDLER;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> EXCEPTION_CONTINUE_SEARCH;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __try &#123;</span><br><span class="line">        <span class="keyword">int</span> *a=<span class="literal">NULL</span>;</span><br><span class="line">        *a=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    __except (FilterFunc(GetExceptionCode()))&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SEH final\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;in main&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该段代码在 32 位和 64 位上均有效，不过在汇编层面的具体实现方式不同。</p><p>其中<code>__try</code>关键字和<code>__except</code>关键字共同完成异常处理，<code>__try</code>关键字用来捕获异常，<code>__except</code>关键字根据后面表达式的值来确定当前的异常处理模块是否可以处理该种异常。括号内表达式值有三种：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//https://docs.microsoft.com/en-us/cpp/cpp/try-except-statement?view=msvc-160</span></span><br><span class="line">EXCEPTION_CONTINUE_EXECUTION (–<span class="number">1</span>)          <span class="comment">//异常被忽略，控制流将在异常出现的点之后，继续恢复运行。</span></span><br><span class="line">EXCEPTION_CONTINUE_SEARCH (<span class="number">0</span>)              <span class="comment">//异常不被识别，也即当前的这个__except模块不是这个异常错误所对应的正确的异常处理模块。</span></span><br><span class="line">EXCEPTION_EXECUTE_HANDLER (<span class="number">1</span>)              <span class="comment">//异常已经被识别，控制流将进入到__except模块中运行异常处理代码</span></span><br></pre></td></tr></table></figure><p>而<code>FilterFunc</code>函数参数中的<code>GetExceptionCode</code>函数作用是获取异常代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//minwinbase.h</span></span><br><span class="line"><span class="comment">/* compatibility macros */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_ACCESS_VIOLATION          STATUS_ACCESS_VIOLATION</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_DATATYPE_MISALIGNMENT     STATUS_DATATYPE_MISALIGNMENT</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_BREAKPOINT                STATUS_BREAKPOINT</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_SINGLE_STEP               STATUS_SINGLE_STEP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_ARRAY_BOUNDS_EXCEEDED     STATUS_ARRAY_BOUNDS_EXCEEDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_FLT_DENORMAL_OPERAND      STATUS_FLOAT_DENORMAL_OPERAND</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_FLT_DIVIDE_BY_ZERO        STATUS_FLOAT_DIVIDE_BY_ZERO</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_FLT_INEXACT_RESULT        STATUS_FLOAT_INEXACT_RESULT</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_FLT_INVALID_OPERATION     STATUS_FLOAT_INVALID_OPERATION</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_FLT_OVERFLOW              STATUS_FLOAT_OVERFLOW</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_FLT_STACK_CHECK           STATUS_FLOAT_STACK_CHECK</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_FLT_UNDERFLOW             STATUS_FLOAT_UNDERFLOW</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_INT_DIVIDE_BY_ZERO        STATUS_INTEGER_DIVIDE_BY_ZERO</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_INT_OVERFLOW              STATUS_INTEGER_OVERFLOW</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_PRIV_INSTRUCTION          STATUS_PRIVILEGED_INSTRUCTION</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_IN_PAGE_ERROR             STATUS_IN_PAGE_ERROR</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_ILLEGAL_INSTRUCTION       STATUS_ILLEGAL_INSTRUCTION</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_NONCONTINUABLE_EXCEPTION  STATUS_NONCONTINUABLE_EXCEPTION</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_STACK_OVERFLOW            STATUS_STACK_OVERFLOW</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_INVALID_DISPOSITION       STATUS_INVALID_DISPOSITION</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_GUARD_PAGE                STATUS_GUARD_PAGE_VIOLATION</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_INVALID_HANDLE            STATUS_INVALID_HANDLE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXCEPTION_POSSIBLE_DEADLOCK         STATUS_POSSIBLE_DEADLOCK</span></span><br><span class="line"><span class="comment">//确切的常数定义在winnt.h</span></span><br></pre></td></tr></table></figure><p>其中常用的如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">EXCEPTION_ACCESS_VIOLATION    非法访问异常</span><br><span class="line">EXCEPTION_BREAKPOINT          int 3 断点异常</span><br><span class="line">EXCEPTION_ILLEGAL_INSTRUCTION 无法解析指令异常</span><br><span class="line">EXCEPTION_INT_DIVIDE_BY_ZERO  整数除 0 异常</span><br><span class="line">EXCEPTION_SINGLE_STEP         单步工作模式异常</span><br></pre></td></tr></table></figure><p>除<code>GetExceptionCode</code>外，还有一个函数<code>GetExceptionInformation</code>用于获取异常的详细信息。</p><p>另外，还有<code>__try-__finally</code>语句,<code>finally</code>没有表达式，即异常直接被<code>finally</code>中的语句处理(或直接跳过)。</p><h2 id="在32位汇编中注册-SEH-异常处理函数"><a href="#在32位汇编中注册-SEH-异常处理函数" class="headerlink" title="在32位汇编中注册 SEH 异常处理函数"></a>在32位汇编中注册 SEH 异常处理函数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">push SEHfunction</span><br><span class="line">push DWORD PTR FS:[0]</span><br><span class="line">mov DWORD PTR FS:[0],esp</span><br></pre></td></tr></table></figure><p>该段代码仅适用于 32 位，64 位中 SEH 由编译器直接注册</p><h2 id="对反汇编的-SEH-进行分析"><a href="#对反汇编的-SEH-进行分析" class="headerlink" title="对反汇编的 SEH 进行分析"></a>对反汇编的 SEH 进行分析</h2><p>对32位来说很简单，查看上面汇编代码的特征即可：<br>该段代码由上面的示例代码在 vs2019 中生成<br><img src="/pictures/32%E4%BD%8DSEH.jpg" alt="32位SEH"><br>而对64位来说，由于 SEH 不在函数中动态注册，分析起来有一定难度。<br>对于64位 PE 文件，编译器在其头部嵌入了几乎所有（一小部分特殊函数没有）函数的 SEH 信息。每个函数是否使用了SEH，使用的是什么 SEH（__except还是__finally)等，就在 PE 的<code>Exception Directory</code>里。所以我们如果要找64位函数所使用的 SEH 的话，需要先取得该函数的相对偏移地址（RVA），然后到该目录下找，示例还是上文的代码，所用工具为<code>CFF Explorer</code>,异常就在<code>main</code>函数内触发，<code>main</code>的偏移为<code>0x11900</code>。可以看到这里出现的<code>BeginAddress</code>为异常的<code>__try</code>块起始位置，<code>EndAddress</code>为<code>__try</code>的结束位置（在该程序中似乎不太照应，可能是编译器优化），而<code>HandlerAddress</code>是调用<code>FilterFunc</code>函数的代码，<code>JumpTarget</code>是<code>__except</code>的代码。<br><img src="/pictures/64%E4%BD%8DPE.jpg" alt="32位SEH"><br><img src="/pictures/main.jpg" alt="32位SEH"><br><img src="/pictures/callexcept.jpg" alt="32位SEH"><br>（详细信息可参考这位大牛的<a href="https://cloud.tencent.com/developer/article/1471316">SEH分析笔记（X64篇） - 云+社区 - 腾讯云</a>）。</p>]]></content>
    
    
    <summary type="html">简单 SEH 理解</summary>
    
    
    
    <category term="《逆向工程核心原理》笔记" scheme="https://4nsw3r.top/categories/%E3%80%8A%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="CTF-RE" scheme="https://4nsw3r.top/tags/CTF-RE/"/>
    
    <category term="SEH" scheme="https://4nsw3r.top/tags/SEH/"/>
    
  </entry>
  
  <entry>
    <title>静态反调试技术</title>
    <link href="https://4nsw3r.top/2021/08/03/%E9%9D%99%E6%80%81%E5%8F%8D%E8%B0%83%E8%AF%95%E6%8A%80%E6%9C%AF/"/>
    <id>https://4nsw3r.top/2021/08/03/%E9%9D%99%E6%80%81%E5%8F%8D%E8%B0%83%E8%AF%95%E6%8A%80%E6%9C%AF/</id>
    <published>2021-08-03T11:33:06.160Z</published>
    <updated>2021-08-03T12:16:01.844Z</updated>
    
    <content type="html"><![CDATA[<h1 id="静态反调试技术"><a href="#静态反调试技术" class="headerlink" title="静态反调试技术"></a>静态反调试技术</h1><h2 id="PEB-进程环境块-反调"><a href="#PEB-进程环境块-反调" class="headerlink" title="PEB (进程环境块)反调"></a>PEB (进程环境块)反调</h2><h3 id="PEB-的概念"><a href="#PEB-的概念" class="headerlink" title="PEB 的概念"></a>PEB 的概念</h3><p>PEB(Process Environment Block)是存放进程信息的结构体，与之概念类似的是 TEB(Thread Environment Block)，即线程环境块，PEB 的指针 是 TEB 结构体的成员，因此想要访问 PEB ，就可以通过系统 API <code>Ntdll.NtCurrentTeb()</code>访问 TEB 再加上 0x30 得到。而在汇编层面中，FS 段寄存器用来指示当前线程的 TEB ，<code>FS:[0x30]</code>就是 PEB 的地址，<code>FS:[0x18]</code> 就是 TEB 的地址。<br>注意：PEB 在各个版本的系统中不太一样，因此使用库函数即可准确获取到自己想要的信息，是最稳妥的办法。<a href="#win10-PEB">win10 PEB</a> 附在文后。</p><h3 id="PEB-中比较重要的成员"><a href="#PEB-中比较重要的成员" class="headerlink" title="PEB 中比较重要的成员"></a>PEB 中比较重要的成员</h3><h4 id="002-BeingDebugged-XP、win7、win10-都适用"><a href="#002-BeingDebugged-XP、win7、win10-都适用" class="headerlink" title="+002 BeingDebugged(XP、win7、win10 都适用)"></a>+002 BeingDebugged(XP、win7、win10 都适用)</h4><p>该成员用于判断当前进程是否处于调试状态。<br><code>BeingDebugged</code>可由<code>Kernelbase.dll</code>中的<code>IsDebuggerPresent()</code>API 来得到，示例代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(IsDebuggerPresent())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意：在使用调试器附加到进程时，该值也会生效。</strong></p><h4 id="0xC-Ldr"><a href="#0xC-Ldr" class="headerlink" title="+0xC Ldr"></a>+0xC Ldr</h4><p><strong>注意：Ldr 的反调试仅适用于 XP 系统。</strong><br>在调试时，堆内存区域会出现一些特殊的标识，未使用的堆内存区域填充为<code>0xEEFEEEFE</code>，而Ldr指向 _PEB_LDR_DATA 结构体，该结构体是在堆内存中创建的。</p><h4 id="0x18-ProcessHeap"><a href="#0x18-ProcessHeap" class="headerlink" title="+0x18 ProcessHeap"></a>+0x18 ProcessHeap</h4><p><strong>注意：ProcessHeap 的反调试仅适用于 XP 系统。</strong><br>该成员是指向 HEAP 结构体的指针，而 HEAP 结构体中的 Flags(+0xC)和 ForceFlags(+0x10)成员在正常运行时为 2和 0 。ProcessHeap 可由<code>GetProcessHeap()</code>API 得到。</p><h4 id="0x68-NtGlobalFlag-XP、win7、win10都适用"><a href="#0x68-NtGlobalFlag-XP、win7、win10都适用" class="headerlink" title="+0x68 NtGlobalFlag(XP、win7、win10都适用)"></a>+0x68 NtGlobalFlag(XP、win7、win10都适用)</h4><p>调试时，NtGlobalFlag 的值为 0x70 。</p><p><strong>注意：使用调试器附加时，该值不变</strong></p><h2 id="NtQueryInformationProcess"><a href="#NtQueryInformationProcess" class="headerlink" title="NtQueryInformationProcess()"></a>NtQueryInformationProcess()</h2><p>函数定义如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__kernel_entry NTSTATUS <span class="title">NtQueryInformationProcess</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HANDLE           ProcessHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">    PROCESSINFOCLASS ProcessInformationClass,</span></span></span><br><span class="line"><span class="params"><span class="function">    PVOID            ProcessInformation,</span></span></span><br><span class="line"><span class="params"><span class="function">    ULONG            ProcessInformationLength,</span></span></span><br><span class="line"><span class="params"><span class="function">    PULONG           ReturnLength</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure><p>其中<code>ProcessHandle</code>为进程句柄，第3个参数根据第二个 enum 的值来传出不同值，第二个参数如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> _<span class="title">PROCESSINFOCLASS</span>&#123;</span></span><br><span class="line">    ProcessBasicInformation = <span class="number">1</span>, </span><br><span class="line">    ProcessQuotaLimits, </span><br><span class="line">    ProcessIoCounters, </span><br><span class="line">    ProcessVmCounters ProcessTimes, </span><br><span class="line">    ProcessBasePriority, </span><br><span class="line">    ProcessRaisePriority, </span><br><span class="line">    ProcessDebugPort = <span class="number">7</span>, </span><br><span class="line">    ProcessExceptionPort, </span><br><span class="line">    ProcessAccessToken, </span><br><span class="line">    ProcessLdtInformation, </span><br><span class="line">    ProcessLdtSize, </span><br><span class="line">    ProcessDefaultHardErrorMode, </span><br><span class="line">    ProcessIoPortHandlers, </span><br><span class="line">    ProcessPooledUsageAndLimits, </span><br><span class="line">    ProcessWorkingSetWatch, </span><br><span class="line">    ProcessUserModeIOPL, </span><br><span class="line">    rocessEnableAlignmentFaultFixup, </span><br><span class="line">    ProcessPriorityClass, </span><br><span class="line">    ProcessWx86Information, </span><br><span class="line">    ProcessHandleCount, </span><br><span class="line">    ProcessAffinityMask, </span><br><span class="line">    ProcessPriorityBoost, </span><br><span class="line">    ProcessDeviceMap, </span><br><span class="line">    ProcessSessionInformation, </span><br><span class="line">    ProcessForegroundInformation, </span><br><span class="line">    ProcessWow64Information = <span class="number">26</span>, </span><br><span class="line">    ProcessImageFileName = <span class="number">27</span>, </span><br><span class="line">    ProcessLUIDDeviceMapsEnabled, </span><br><span class="line">    ProcessBreakOnTermination, </span><br><span class="line">    ProcessDebugObjectHandle = <span class="number">30</span>, </span><br><span class="line">    ProcessDebugFlags = <span class="number">31</span>, </span><br><span class="line">    ProcessHandleTracing, </span><br><span class="line">    ProcessUnknown33, </span><br><span class="line">    ProcessUnknown34, </span><br><span class="line">    ProcessUnknown35, </span><br><span class="line">    ProcessCookie, </span><br><span class="line">    MaxProcessInfoClass </span><br><span class="line">&#125; PROCESSINFOCLASS;</span><br></pre></td></tr></table></figure><p>该函数虽然存在于<code>winternl.h</code>中，但直接从头文件引入却会有链接错误，需要加载<code>ntdll.dll</code>来使用:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">NTSTATUS</span><span class="params">(NTAPI* pfnNtQueryInformationProcess)</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">_In_      HANDLE           ProcessHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">_In_      UINT             ProcessInformationClass,</span></span></span><br><span class="line"><span class="params"><span class="function">_Out_     PVOID            ProcessInformation,</span></span></span><br><span class="line"><span class="params"><span class="function">_In_      ULONG            ProcessInformationLength,</span></span></span><br><span class="line"><span class="params"><span class="function">_Out_opt_ PULONG           ReturnLength</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line">HMODULE hNtDll = LoadLibraryA(<span class="string">&quot;ntdll.dll&quot;</span>);</span><br><span class="line">pfnNtQueryInformationProcess NtQueryInformationProcess=<span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">if</span> (hNtDll)</span><br><span class="line">&#123;</span><br><span class="line">    NtQueryInformationProcess = (pfnNtQueryInformationProcess)GetProcAddress(hNtDll, <span class="string">&quot;NtQueryInformationProcess&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ProcessDebugPort-0x7"><a href="#ProcessDebugPort-0x7" class="headerlink" title="ProcessDebugPort (0x7)"></a>ProcessDebugPort (0x7)</h3><h4 id="使用原函数"><a href="#使用原函数" class="headerlink" title="使用原函数"></a>使用原函数</h4><p>进程处于调试状态时，系统会分配一个调试端口。当 enum 的值为 0x7 时，使用该函数就能在第三个参数处获取调试端口，若进程处于非调试状态，则传出的值为 0 ，处于调试状态则传出<code>0xFFFFFFFF</code>。示例代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> Port;</span><br><span class="line">NtQueryInformationProcess(GetCurrentProcess(),ProcessDebugPort,&amp;Port,<span class="keyword">sizeof</span>(Port),<span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span>(Port)</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h4 id="使用-CheckRemoteDebuggerPresent"><a href="#使用-CheckRemoteDebuggerPresent" class="headerlink" title="使用 CheckRemoteDebuggerPresent()"></a>使用 CheckRemoteDebuggerPresent()</h4><p>该函数与<code>IsDebuggerPresent()</code>类似，但其不仅可以检测当前进程，还可用于检测其他进程是否处于调试状态。</p><p>函数原型：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">CheckRemoteDebuggerPresent</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HANDLE hProcess,</span></span></span><br><span class="line"><span class="params"><span class="function">    PBOOL  pbDebuggerPresent</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> status;</span><br><span class="line">CheckRemoteDebuggerPresent(GetcurrentProcess(),&amp;status);</span><br><span class="line"><span class="keyword">if</span>(status)</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>实际上在该函数内部仍然使用了NtQueryInformationProcess() 函数：<img src="/pictures/call%20NtQueryInformationProcess.jpg" alt="使用原函数"></p><h3 id="ProcessDebugObjectHandle-0x1E"><a href="#ProcessDebugObjectHandle-0x1E" class="headerlink" title="ProcessDebugObjectHandle(0x1E)"></a>ProcessDebugObjectHandle(0x1E)</h3><p>调试进程时会生成调试对象，函数的第二个参数值为 ProcessDebugObjectHandle(0x1E) 时，传出的第三个参数为调试对象句柄。非调试状态时传出NULL。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> handle;</span><br><span class="line">NtQueryInformationProcess(GetCurrentProcess(),ProcessDebugObjectHandle,&amp;handle,<span class="keyword">sizeof</span>(handle),<span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span>(!handle)</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h3 id="ProcessDebugFlags-0x1F"><a href="#ProcessDebugFlags-0x1F" class="headerlink" title="ProcessDebugFlags(0x1F)"></a>ProcessDebugFlags(0x1F)</h3><p>第二个参数值为 ProcessDebugFlags(0x1F) 时，第三个参数传出调试标志的值。若为 0 则被调试，若为 1 则非调试。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> flag;</span><br><span class="line">NtQueryInformationProcess(GetCurrentProcess(),ProcessDebugFlags,&amp;flag,<span class="keyword">sizeof</span>(flag),<span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span>(!flag)</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h2 id="NtQuerySystemInformation-检测OS"><a href="#NtQuerySystemInformation-检测OS" class="headerlink" title="NtQuerySystemInformation() 检测OS"></a>NtQuerySystemInformation() 检测OS</h2><p>该函数用来获取当前运行的多种 OS 信息，以此来判断有无调试环境，间接判断程序是否为调试状态。</p><p>函数原型：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//https://docs.microsoft.com/en-us/windows/win32/api/winternl/nf-winternl-ntquerysysteminformation</span></span><br><span class="line"><span class="function">__kernel_entry NTSTATUS <span class="title">NtQuerySystemInformation</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    SYSTEM_INFORMATION_CLASS SystemInformationClass,</span></span></span><br><span class="line"><span class="params"><span class="function">    PVOID                    SystemInformation,</span></span></span><br><span class="line"><span class="params"><span class="function">    ULONG                    SystemInformationLength,</span></span></span><br><span class="line"><span class="params"><span class="function">    PULONG                   ReturnLength</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure><p>参数解释： SystemInformationClass 中指定需要的系统信息类型，将信息结构体的地址传递给 SystemInformation 参数。</p><p>SYSTEM_INFORMATION_CLASS 类型定义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//winternl.h</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> _<span class="title">SYSTEM_INFORMATION_CLASS</span> &#123;</span></span><br><span class="line">    SystemBasicInformation = <span class="number">0</span>,</span><br><span class="line">    SystemPerformanceInformation = <span class="number">2</span>,</span><br><span class="line">    SystemTimeOfDayInformation = <span class="number">3</span>,</span><br><span class="line">    SystemProcessInformation = <span class="number">5</span>,</span><br><span class="line">    SystemProcessorPerformanceInformation = <span class="number">8</span>,</span><br><span class="line">    SystemInterruptInformation = <span class="number">23</span>,</span><br><span class="line">    SystemExceptionInformation = <span class="number">33</span>,</span><br><span class="line">    SystemKernelDebuggerInformation = <span class="number">35</span>,</span><br><span class="line">    SystemRegistryQuotaInformation = <span class="number">37</span>,</span><br><span class="line">    SystemLookasideInformation = <span class="number">45</span>,</span><br><span class="line">    SystemCodeIntegrityInformation = <span class="number">103</span>,</span><br><span class="line">    SystemPolicyInformation = <span class="number">134</span>,</span><br><span class="line">&#125; SYSTEM_INFORMATION_CLASS;</span><br></pre></td></tr></table></figure><p>该函数定义存在于 winternl.h 但直接使用会出现链接错误，因此需加载 ntdll.dll 使用：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">NTSTATUS</span> <span class="params">(WINAPI* pfnNtQuerySystemInformation)</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    SYSTEM_INFORMATION_CLASS SystemInformationClass,</span></span></span><br><span class="line"><span class="params"><span class="function">    PVOID                    SystemInformation,</span></span></span><br><span class="line"><span class="params"><span class="function">    ULONG                    SystemInformationLength,</span></span></span><br><span class="line"><span class="params"><span class="function">    PULONG                   ReturnLength</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line">HMODULE hNtDll = LoadLibraryA(<span class="string">&quot;ntdll.dll&quot;</span>);</span><br><span class="line">pfnNtQuerySystemInformation NtQuerySystemInformation=<span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">if</span> (hNtDll)</span><br><span class="line">&#123;</span><br><span class="line">    NtQuerySystemInformation = (pfnNtQuerySystemInformation)GetProcAddress(hNtDll, <span class="string">&quot;NtQuerySystemInformation&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SystemKernelDebuggerInformation-0x23-检测-OS-是否处于调试模式"><a href="#SystemKernelDebuggerInformation-0x23-检测-OS-是否处于调试模式" class="headerlink" title="SystemKernelDebuggerInformation(0x23) 检测 OS 是否处于调试模式"></a>SystemKernelDebuggerInformation(0x23) 检测 OS 是否处于调试模式</h3><p>使用以上方法引入 NtQuerySystemInformation 函数后，即可使用该函数完成功能。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">DebuggerInformation</span> &#123;</span></span><br><span class="line">    BOOLEAN DebuggerEnabled;</span><br><span class="line">    BOOLEAN DebuggerNotPresent;</span><br><span class="line">&#125;DebuggerInformation;</span><br><span class="line">DebuggerInformation info;</span><br><span class="line">NtQuerySystemInformation((SYSTEM_INFORMATION_CLASS)<span class="number">0x23</span>,&amp;info,<span class="keyword">sizeof</span>(info),<span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span>(info.DebuggerEnabled)</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h2 id="ZwSetInformationThread-强制分离被调试者与调试器"><a href="#ZwSetInformationThread-强制分离被调试者与调试器" class="headerlink" title="ZwSetInformationThread()  强制分离被调试者与调试器"></a>ZwSetInformationThread()  强制分离被调试者与调试器</h2><p>该函数可强制分离被调试者与调试器。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">DWORD</span><span class="params">(WINAPI* ZW_SET_INFORMATION_THREAD)</span> <span class="params">(HANDLE, DWORD, PVOID, ULONG)</span></span>;</span><br><span class="line">HMODULE hNtDll = LoadLibraryA(<span class="string">&quot;ntdll.dll&quot;</span>);</span><br><span class="line">ZW_SET_INFORMATION_THREAD ZSsetInformationThread = (ZW_SET_INFORMATION_THREAD)GetProcAddress(hNtDll, <span class="string">&quot;ZwSetInformationThread&quot;</span>);</span><br><span class="line">ZwSetInformationThread(GetCurrentThread(),<span class="number">0x11</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure><h2 id="进程检测，窗口检测等"><a href="#进程检测，窗口检测等" class="headerlink" title="进程检测，窗口检测等"></a>进程检测，窗口检测等</h2><p>检测窗口：FindWindow()</p><p>检测进程：CreateToolhelp32Snapshot()</p><p>获取计算机名称：GetComputerName()</p><p>检查程序运行路径：GetCommandLine()</p><p>检查是否有虚拟机运行：检查特定进程：VMWareService.exe</p><h2 id="win10-PEB"><a href="#win10-PEB" class="headerlink" title="win10 PEB"></a>win10 PEB</h2><h3 id="32位："><a href="#32位：" class="headerlink" title="32位："></a>32位：</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//dt _PEB in windbg</span></span><br><span class="line">+<span class="number">0x000</span> InheritedAddressSpace : UChar</span><br><span class="line">+<span class="number">0x001</span> ReadImageFileExecOptions : UChar</span><br><span class="line">+<span class="number">0x002</span> BeingDebugged    : UChar</span><br><span class="line">+<span class="number">0x003</span> BitField         : UChar</span><br><span class="line">+<span class="number">0x003</span> ImageUsesLargePages : Pos <span class="number">0</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> IsProtectedProcess : Pos <span class="number">1</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> IsImageDynamicallyRelocated : Pos <span class="number">2</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> SkipPatchingUser32Forwarders : Pos <span class="number">3</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> IsPackagedProcess : Pos <span class="number">4</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> IsAppContainer   : Pos <span class="number">5</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> IsProtectedProcessLight : Pos <span class="number">6</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> IsLongPathAwareProcess : Pos <span class="number">7</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x004</span> Mutant           : Ptr32 Void</span><br><span class="line">+<span class="number">0x008</span> ImageBaseAddress : Ptr32 Void</span><br><span class="line">+<span class="number">0x00c</span> Ldr              : Ptr32 _PEB_LDR_DATA</span><br><span class="line">+<span class="number">0x010</span> ProcessParameters : Ptr32 _RTL_USER_PROCESS_PARAMETERS</span><br><span class="line">+<span class="number">0x014</span> SubSystemData    : Ptr32 Void</span><br><span class="line">+<span class="number">0x018</span> ProcessHeap      : Ptr32 Void</span><br><span class="line">+<span class="number">0x01c</span> FastPebLock      : Ptr32 _RTL_CRITICAL_SECTION</span><br><span class="line">+<span class="number">0x020</span> AtlThunkSListPtr : Ptr32 _SLIST_HEADER</span><br><span class="line">+<span class="number">0x024</span> IFEOKey          : Ptr32 Void</span><br><span class="line">+<span class="number">0x028</span> CrossProcessFlags : Uint4B</span><br><span class="line">+<span class="number">0x028</span> ProcessInJob     : Pos <span class="number">0</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x028</span> ProcessInitializing : Pos <span class="number">1</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x028</span> ProcessUsingVEH  : Pos <span class="number">2</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x028</span> ProcessUsingVCH  : Pos <span class="number">3</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x028</span> ProcessUsingFTH  : Pos <span class="number">4</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x028</span> ProcessPreviouslyThrottled : Pos <span class="number">5</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x028</span> ProcessCurrentlyThrottled : Pos <span class="number">6</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x028</span> ProcessImagesHotPatched : Pos <span class="number">7</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x028</span> ReservedBits0    : Pos <span class="number">8</span>, <span class="number">24</span> Bits</span><br><span class="line">+<span class="number">0x02c</span> KernelCallbackTable : Ptr32 Void</span><br><span class="line">+<span class="number">0x02c</span> UserSharedInfoPtr : Ptr32 Void</span><br><span class="line">+<span class="number">0x030</span> SystemReserved   : Uint4B</span><br><span class="line">+<span class="number">0x034</span> AtlThunkSListPtr32 : Ptr32 _SLIST_HEADER</span><br><span class="line">+<span class="number">0x038</span> ApiSetMap        : Ptr32 Void</span><br><span class="line">+<span class="number">0x03c</span> TlsExpansionCounter : Uint4B</span><br><span class="line">+<span class="number">0x040</span> TlsBitmap        : Ptr32 Void</span><br><span class="line">+<span class="number">0x044</span> TlsBitmapBits    : [<span class="number">2</span>] Uint4B</span><br><span class="line">+<span class="number">0x04c</span> ReadOnlySharedMemoryBase : Ptr32 Void</span><br><span class="line">+<span class="number">0x050</span> SharedData       : Ptr32 Void</span><br><span class="line">+<span class="number">0x054</span> ReadOnlyStaticServerData : Ptr32 Ptr32 Void</span><br><span class="line">+<span class="number">0x058</span> AnsiCodePageData : Ptr32 Void</span><br><span class="line">+<span class="number">0x05c</span> OemCodePageData  : Ptr32 Void</span><br><span class="line">+<span class="number">0x060</span> UnicodeCaseTableData : Ptr32 Void</span><br><span class="line">+<span class="number">0x064</span> NumberOfProcessors : Uint4B</span><br><span class="line">+<span class="number">0x068</span> NtGlobalFlag     : Uint4B</span><br><span class="line">+<span class="number">0x070</span> CriticalSectionTimeout : _LARGE_INTEGER</span><br><span class="line">+<span class="number">0x078</span> HeapSegmentReserve : Uint4B</span><br><span class="line">+<span class="number">0x07c</span> HeapSegmentCommit : Uint4B</span><br><span class="line">+<span class="number">0x080</span> HeapDeCommitTotalFreeThreshold : Uint4B</span><br><span class="line">+<span class="number">0x084</span> HeapDeCommitFreeBlockThreshold : Uint4B</span><br><span class="line">+<span class="number">0x088</span> NumberOfHeaps    : Uint4B</span><br><span class="line">+<span class="number">0x08c</span> MaximumNumberOfHeaps : Uint4B</span><br><span class="line">+<span class="number">0x090</span> ProcessHeaps     : Ptr32 Ptr32 Void</span><br><span class="line">+<span class="number">0x094</span> GdiSharedHandleTable : Ptr32 Void</span><br><span class="line">+<span class="number">0x098</span> ProcessStarterHelper : Ptr32 Void</span><br><span class="line">+<span class="number">0x09c</span> GdiDCAttributeList : Uint4B</span><br><span class="line">+<span class="number">0x0a0</span> LoaderLock       : Ptr32 _RTL_CRITICAL_SECTION</span><br><span class="line">+<span class="number">0x0a4</span> OSMajorVersion   : Uint4B</span><br><span class="line">+<span class="number">0x0a8</span> OSMinorVersion   : Uint4B</span><br><span class="line">+<span class="number">0x0ac</span> OSBuildNumber    : Uint2B</span><br><span class="line">+<span class="number">0x0ae</span> OSCSDVersion     : Uint2B</span><br><span class="line">+<span class="number">0x0b0</span> OSPlatformId     : Uint4B</span><br><span class="line">+<span class="number">0x0b4</span> ImageSubsystem   : Uint4B</span><br><span class="line">+<span class="number">0x0b8</span> ImageSubsystemMajorVersion : Uint4B</span><br><span class="line">+<span class="number">0x0bc</span> ImageSubsystemMinorVersion : Uint4B</span><br><span class="line">+<span class="number">0x0c0</span> ActiveProcessAffinityMask : Uint4B</span><br><span class="line">+<span class="number">0x0c4</span> GdiHandleBuffer  : [<span class="number">34</span>] Uint4B</span><br><span class="line">+<span class="number">0x14c</span> PostProcessInitRoutine : Ptr32     <span class="keyword">void</span> </span><br><span class="line">+<span class="number">0x150</span> TlsExpansionBitmap : Ptr32 Void</span><br><span class="line">+<span class="number">0x154</span> TlsExpansionBitmapBits : [<span class="number">32</span>] Uint4B</span><br><span class="line">+<span class="number">0x1d4</span> SessionId        : Uint4B</span><br><span class="line">+<span class="number">0x1d8</span> AppCompatFlags   : _ULARGE_INTEGER</span><br><span class="line">+<span class="number">0x1e0</span> AppCompatFlagsUser : _ULARGE_INTEGER</span><br><span class="line">+<span class="number">0x1e8</span> pShimData        : Ptr32 Void</span><br><span class="line">+<span class="number">0x1ec</span> AppCompatInfo    : Ptr32 Void</span><br><span class="line">+<span class="number">0x1f0</span> CSDVersion       : _UNICODE_STRING</span><br><span class="line">+<span class="number">0x1f8</span> ActivationContextData : Ptr32 _ACTIVATION_CONTEXT_DATA</span><br><span class="line">+<span class="number">0x1fc</span> ProcessAssemblyStorageMap : Ptr32 _ASSEMBLY_STORAGE_MAP</span><br><span class="line">+<span class="number">0x200</span> SystemDefaultActivationContextData : Ptr32 _ACTIVATION_CONTEXT_DATA</span><br><span class="line">+<span class="number">0x204</span> SystemAssemblyStorageMap : Ptr32 _ASSEMBLY_STORAGE_MAP</span><br><span class="line">+<span class="number">0x208</span> MinimumStackCommit : Uint4B</span><br><span class="line">+<span class="number">0x20c</span> SparePointers    : [<span class="number">4</span>] Ptr32 Void</span><br><span class="line">+<span class="number">0x21c</span> SpareUlongs      : [<span class="number">5</span>] Uint4B</span><br><span class="line">+<span class="number">0x230</span> WerRegistrationData : Ptr32 Void</span><br><span class="line">+<span class="number">0x234</span> WerShipAssertPtr : Ptr32 Void</span><br><span class="line">+<span class="number">0x238</span> pUnused          : Ptr32 Void</span><br><span class="line">+<span class="number">0x23c</span> pImageHeaderHash : Ptr32 Void</span><br><span class="line">+<span class="number">0x240</span> TracingFlags     : Uint4B</span><br><span class="line">+<span class="number">0x240</span> HeapTracingEnabled : Pos <span class="number">0</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x240</span> CritSecTracingEnabled : Pos <span class="number">1</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x240</span> LibLoaderTracingEnabled : Pos <span class="number">2</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x240</span> SpareTracingBits : Pos <span class="number">3</span>, <span class="number">29</span> Bits</span><br><span class="line">+<span class="number">0x248</span> CsrServerReadOnlySharedMemoryBase : Uint8B</span><br><span class="line">+<span class="number">0x250</span> TppWorkerpListLock : Uint4B</span><br><span class="line">+<span class="number">0x254</span> TppWorkerpList   : _LIST_ENTRY</span><br><span class="line">+<span class="number">0x25c</span> WaitOnAddressHashTable : [<span class="number">128</span>] Ptr32 Void</span><br><span class="line">+<span class="number">0x45c</span> TelemetryCoverageHeader : Ptr32 Void</span><br><span class="line">+<span class="number">0x460</span> CloudFileFlags   : Uint4B</span><br><span class="line">+<span class="number">0x464</span> CloudFileDiagFlags : Uint4B</span><br><span class="line">+<span class="number">0x468</span> PlaceholderCompatibilityMode : Char</span><br><span class="line">+<span class="number">0x469</span> PlaceholderCompatibilityModeReserved : [<span class="number">7</span>] Char</span><br><span class="line">+<span class="number">0x470</span> LeapSecondData   : Ptr32 _LEAP_SECOND_DATA</span><br><span class="line">+<span class="number">0x474</span> LeapSecondFlags  : Uint4B</span><br><span class="line">+<span class="number">0x474</span> SixtySecondEnabled : Pos <span class="number">0</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x474</span> Reserved         : Pos <span class="number">1</span>, <span class="number">31</span> Bits</span><br><span class="line">+<span class="number">0x478</span> NtGlobalFlag2    : Uint4B</span><br></pre></td></tr></table></figure><h3 id="64位："><a href="#64位：" class="headerlink" title="64位："></a>64位：</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">+<span class="number">0x000</span> InheritedAddressSpace : UChar</span><br><span class="line">+<span class="number">0x001</span> ReadImageFileExecOptions : UChar</span><br><span class="line">+<span class="number">0x002</span> BeingDebugged    : UChar</span><br><span class="line">+<span class="number">0x003</span> BitField         : UChar</span><br><span class="line">+<span class="number">0x003</span> ImageUsesLargePages : Pos <span class="number">0</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> IsProtectedProcess : Pos <span class="number">1</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> IsImageDynamicallyRelocated : Pos <span class="number">2</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> SkipPatchingUser32Forwarders : Pos <span class="number">3</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> IsPackagedProcess : Pos <span class="number">4</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> IsAppContainer   : Pos <span class="number">5</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> IsProtectedProcessLight : Pos <span class="number">6</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x003</span> IsLongPathAwareProcess : Pos <span class="number">7</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x004</span> Padding0         : [<span class="number">4</span>] UChar</span><br><span class="line">+<span class="number">0x008</span> Mutant           : Ptr64 Void</span><br><span class="line">+<span class="number">0x010</span> ImageBaseAddress : Ptr64 Void</span><br><span class="line">+<span class="number">0x018</span> Ldr              : Ptr64 _PEB_LDR_DATA</span><br><span class="line">+<span class="number">0x020</span> ProcessParameters : Ptr64 _RTL_USER_PROCESS_PARAMETERS</span><br><span class="line">+<span class="number">0x028</span> SubSystemData    : Ptr64 Void</span><br><span class="line">+<span class="number">0x030</span> ProcessHeap      : Ptr64 Void</span><br><span class="line">+<span class="number">0x038</span> FastPebLock      : Ptr64 _RTL_CRITICAL_SECTION</span><br><span class="line">+<span class="number">0x040</span> AtlThunkSListPtr : Ptr64 _SLIST_HEADER</span><br><span class="line">+<span class="number">0x048</span> IFEOKey          : Ptr64 Void</span><br><span class="line">+<span class="number">0x050</span> CrossProcessFlags : Uint4B</span><br><span class="line">+<span class="number">0x050</span> ProcessInJob     : Pos <span class="number">0</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x050</span> ProcessInitializing : Pos <span class="number">1</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x050</span> ProcessUsingVEH  : Pos <span class="number">2</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x050</span> ProcessUsingVCH  : Pos <span class="number">3</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x050</span> ProcessUsingFTH  : Pos <span class="number">4</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x050</span> ProcessPreviouslyThrottled : Pos <span class="number">5</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x050</span> ProcessCurrentlyThrottled : Pos <span class="number">6</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x050</span> ProcessImagesHotPatched : Pos <span class="number">7</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x050</span> ReservedBits0    : Pos <span class="number">8</span>, <span class="number">24</span> Bits</span><br><span class="line">+<span class="number">0x054</span> Padding1         : [<span class="number">4</span>] UChar</span><br><span class="line">+<span class="number">0x058</span> KernelCallbackTable : Ptr64 Void</span><br><span class="line">+<span class="number">0x058</span> UserSharedInfoPtr : Ptr64 Void</span><br><span class="line">+<span class="number">0x060</span> SystemReserved   : Uint4B</span><br><span class="line">+<span class="number">0x064</span> AtlThunkSListPtr32 : Uint4B</span><br><span class="line">+<span class="number">0x068</span> ApiSetMap        : Ptr64 Void</span><br><span class="line">+<span class="number">0x070</span> TlsExpansionCounter : Uint4B</span><br><span class="line">+<span class="number">0x074</span> Padding2         : [<span class="number">4</span>] UChar</span><br><span class="line">+<span class="number">0x078</span> TlsBitmap        : Ptr64 Void</span><br><span class="line">+<span class="number">0x080</span> TlsBitmapBits    : [<span class="number">2</span>] Uint4B</span><br><span class="line">+<span class="number">0x088</span> ReadOnlySharedMemoryBase : Ptr64 Void</span><br><span class="line">+<span class="number">0x090</span> SharedData       : Ptr64 Void</span><br><span class="line">+<span class="number">0x098</span> ReadOnlyStaticServerData : Ptr64 Ptr64 Void</span><br><span class="line">+<span class="number">0x0a0</span> AnsiCodePageData : Ptr64 Void</span><br><span class="line">+<span class="number">0x0a8</span> OemCodePageData  : Ptr64 Void</span><br><span class="line">+<span class="number">0x0b0</span> UnicodeCaseTableData : Ptr64 Void</span><br><span class="line">+<span class="number">0x0b8</span> NumberOfProcessors : Uint4B</span><br><span class="line">+<span class="number">0x0bc</span> NtGlobalFlag     : Uint4B</span><br><span class="line">+<span class="number">0x0c0</span> CriticalSectionTimeout : _LARGE_INTEGER</span><br><span class="line">+<span class="number">0x0c8</span> HeapSegmentReserve : Uint8B</span><br><span class="line">+<span class="number">0x0d0</span> HeapSegmentCommit : Uint8B</span><br><span class="line">+<span class="number">0x0d8</span> HeapDeCommitTotalFreeThreshold : Uint8B</span><br><span class="line">+<span class="number">0x0e0</span> HeapDeCommitFreeBlockThreshold : Uint8B</span><br><span class="line">+<span class="number">0x0e8</span> NumberOfHeaps    : Uint4B</span><br><span class="line">+<span class="number">0x0ec</span> MaximumNumberOfHeaps : Uint4B</span><br><span class="line">+<span class="number">0x0f0</span> ProcessHeaps     : Ptr64 Ptr64 Void</span><br><span class="line">+<span class="number">0x0f8</span> GdiSharedHandleTable : Ptr64 Void</span><br><span class="line">+<span class="number">0x100</span> ProcessStarterHelper : Ptr64 Void</span><br><span class="line">+<span class="number">0x108</span> GdiDCAttributeList : Uint4B</span><br><span class="line">+<span class="number">0x10c</span> Padding3         : [<span class="number">4</span>] UChar</span><br><span class="line">+<span class="number">0x110</span> LoaderLock       : Ptr64 _RTL_CRITICAL_SECTION</span><br><span class="line">+<span class="number">0x118</span> OSMajorVersion   : Uint4B</span><br><span class="line">+<span class="number">0x11c</span> OSMinorVersion   : Uint4B</span><br><span class="line">+<span class="number">0x120</span> OSBuildNumber    : Uint2B</span><br><span class="line">+<span class="number">0x122</span> OSCSDVersion     : Uint2B</span><br><span class="line">+<span class="number">0x124</span> OSPlatformId     : Uint4B</span><br><span class="line">+<span class="number">0x128</span> ImageSubsystem   : Uint4B</span><br><span class="line">+<span class="number">0x12c</span> ImageSubsystemMajorVersion : Uint4B</span><br><span class="line">+<span class="number">0x130</span> ImageSubsystemMinorVersion : Uint4B</span><br><span class="line">+<span class="number">0x134</span> Padding4         : [<span class="number">4</span>] UChar</span><br><span class="line">+<span class="number">0x138</span> ActiveProcessAffinityMask : Uint8B</span><br><span class="line">+<span class="number">0x140</span> GdiHandleBuffer  : [<span class="number">60</span>] Uint4B</span><br><span class="line">+<span class="number">0x230</span> PostProcessInitRoutine : Ptr64     <span class="keyword">void</span> </span><br><span class="line">+<span class="number">0x238</span> TlsExpansionBitmap : Ptr64 Void</span><br><span class="line">+<span class="number">0x240</span> TlsExpansionBitmapBits : [<span class="number">32</span>] Uint4B</span><br><span class="line">+<span class="number">0x2c0</span> SessionId        : Uint4B</span><br><span class="line">+<span class="number">0x2c4</span> Padding5         : [<span class="number">4</span>] UChar</span><br><span class="line">+<span class="number">0x2c8</span> AppCompatFlags   : _ULARGE_INTEGER</span><br><span class="line">+<span class="number">0x2d0</span> AppCompatFlagsUser : _ULARGE_INTEGER</span><br><span class="line">+<span class="number">0x2d8</span> pShimData        : Ptr64 Void</span><br><span class="line">+<span class="number">0x2e0</span> AppCompatInfo    : Ptr64 Void</span><br><span class="line">+<span class="number">0x2e8</span> CSDVersion       : _UNICODE_STRING</span><br><span class="line">+<span class="number">0x2f8</span> ActivationContextData : Ptr64 _ACTIVATION_CONTEXT_DATA</span><br><span class="line">+<span class="number">0x300</span> ProcessAssemblyStorageMap : Ptr64 _ASSEMBLY_STORAGE_MAP</span><br><span class="line">+<span class="number">0x308</span> SystemDefaultActivationContextData : Ptr64 _ACTIVATION_CONTEXT_DATA</span><br><span class="line">+<span class="number">0x310</span> SystemAssemblyStorageMap : Ptr64 _ASSEMBLY_STORAGE_MAP</span><br><span class="line">+<span class="number">0x318</span> MinimumStackCommit : Uint8B</span><br><span class="line">+<span class="number">0x320</span> SparePointers    : [<span class="number">4</span>] Ptr64 Void</span><br><span class="line">+<span class="number">0x340</span> SpareUlongs      : [<span class="number">5</span>] Uint4B</span><br><span class="line">+<span class="number">0x358</span> WerRegistrationData : Ptr64 Void</span><br><span class="line">+<span class="number">0x360</span> WerShipAssertPtr : Ptr64 Void</span><br><span class="line">+<span class="number">0x368</span> pUnused          : Ptr64 Void</span><br><span class="line">+<span class="number">0x370</span> pImageHeaderHash : Ptr64 Void</span><br><span class="line">+<span class="number">0x378</span> TracingFlags     : Uint4B</span><br><span class="line">+<span class="number">0x378</span> HeapTracingEnabled : Pos <span class="number">0</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x378</span> CritSecTracingEnabled : Pos <span class="number">1</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x378</span> LibLoaderTracingEnabled : Pos <span class="number">2</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x378</span> SpareTracingBits : Pos <span class="number">3</span>, <span class="number">29</span> Bits</span><br><span class="line">+<span class="number">0x37c</span> Padding6         : [<span class="number">4</span>] UChar</span><br><span class="line">+<span class="number">0x380</span> CsrServerReadOnlySharedMemoryBase : Uint8B</span><br><span class="line">+<span class="number">0x388</span> TppWorkerpListLock : Uint8B</span><br><span class="line">+<span class="number">0x390</span> TppWorkerpList   : _LIST_ENTRY</span><br><span class="line">+<span class="number">0x3a0</span> WaitOnAddressHashTable : [<span class="number">128</span>] Ptr64 Void</span><br><span class="line">+<span class="number">0x7a0</span> TelemetryCoverageHeader : Ptr64 Void</span><br><span class="line">+<span class="number">0x7a8</span> CloudFileFlags   : Uint4B</span><br><span class="line">+<span class="number">0x7ac</span> CloudFileDiagFlags : Uint4B</span><br><span class="line">+<span class="number">0x7b0</span> PlaceholderCompatibilityMode : Char</span><br><span class="line">+<span class="number">0x7b1</span> PlaceholderCompatibilityModeReserved : [<span class="number">7</span>] Char</span><br><span class="line">+<span class="number">0x7b8</span> LeapSecondData   : Ptr64 _LEAP_SECOND_DATA</span><br><span class="line">+<span class="number">0x7c0</span> LeapSecondFlags  : Uint4B</span><br><span class="line">+<span class="number">0x7c0</span> SixtySecondEnabled : Pos <span class="number">0</span>, <span class="number">1</span> Bit</span><br><span class="line">+<span class="number">0x7c0</span> Reserved         : Pos <span class="number">1</span>, <span class="number">31</span> Bits</span><br><span class="line">+<span class="number">0x7c4</span> NtGlobalFlag2    : Uint4B</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">一些常见的静态反调试技术</summary>
    
    
    
    <category term="《逆向工程核心原理》笔记" scheme="https://4nsw3r.top/categories/%E3%80%8A%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="CTF-RE" scheme="https://4nsw3r.top/tags/CTF-RE/"/>
    
    <category term="反调试" scheme="https://4nsw3r.top/tags/%E5%8F%8D%E8%B0%83%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>TLS 回调函数</title>
    <link href="https://4nsw3r.top/2021/07/27/TLS%20%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0/"/>
    <id>https://4nsw3r.top/2021/07/27/TLS%20%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0/</id>
    <published>2021-07-27T10:31:51.543Z</published>
    <updated>2021-07-27T10:28:39.424Z</updated>
    
    <content type="html"><![CDATA[<h1 id="TLS-回调函数"><a href="#TLS-回调函数" class="headerlink" title="TLS 回调函数"></a>TLS 回调函数</h1><h2 id="简单介绍"><a href="#简单介绍" class="headerlink" title="简单介绍"></a>简单介绍</h2><p>TLS(Thread Local Storage, 线程局部存储)回调函数，TLS 回调函数的调用运行要先于 EP 代码的执行，并且每次创建或结束线程都会再次调用，故常用于反调试。</p><h2 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">VOID</span> <span class="params">(NTAPI *PIMAGE_TLS_CALLBACK)</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">PVOID DllHandle, </span></span></span><br><span class="line"><span class="params"><span class="function">DWORD Reason, </span></span></span><br><span class="line"><span class="params"><span class="function">PVOID Reserved)</span></span>;</span><br></pre></td></tr></table></figure><p>其与 DllMain() 函数的定义十分相似。</p><h2 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h2><h3 id="TLS-和-TLS-的特征"><a href="#TLS-和-TLS-的特征" class="headerlink" title="TLS 和 TLS 的特征"></a>TLS 和 TLS 的特征</h3><p>TLS 是各线程的独立的数据存储空间，使用 TLS 技术可以在线程内部独立使用或修改进程的全局数据或静态数据。</p><p>若启用 TLS 功能，PE 头文件中会设置 TLS 表（TLS Table）项目：</p><p><img src="/pictures/TLS%E8%A1%A8.jpg" alt="启用TLS功能"></p><p>未启用则是这样的：</p><p><img src="/pictures/TLS%E8%A1%A82.jpg" alt="未启用"></p><p>并且如果使用 IDA 打开，会在 Exports 选项卡看到 TlsCallBack 字样：</p><p><img src="/pictures/TLS%E8%A1%A83.jpg" alt="IDA中的TLS"></p><h3 id="TLS-调用原因（Reason）"><a href="#TLS-调用原因（Reason）" class="headerlink" title="TLS 调用原因（Reason）"></a>TLS 调用原因（Reason）</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//winnt.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLL_PROCESS_ATTACH 1 <span class="comment">//进程创建</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLL_THREAD_ATTACH  2 <span class="comment">//线程创建</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLL_THREAD_DETACH  3 <span class="comment">//线程销毁</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLL_PROCESS_DETACH 4 <span class="comment">//进程销毁</span></span></span><br></pre></td></tr></table></figure><h3 id="TLS-回调函数代码示例"><a href="#TLS-回调函数代码示例" class="headerlink" title="TLS 回调函数代码示例"></a>TLS 回调函数代码示例</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//本代码在vs2019x86平台上通过测试</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker,<span class="meta-string">&quot;/INCLUDE:__tls_used&quot;</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> NTAPI <span class="title">TLS_CALLBACK</span><span class="params">(PVOID DllHandle, DWORD Reason, PVOID Reserved)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;TLStest,Reason=%d\n&quot;</span>,Reason);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> data_seg(<span class="meta-string">&quot;.CRT$XLY&quot;</span>)</span></span><br><span class="line">PIMAGE_TLS_CALLBACK tls_callback_func = TLS_CALLBACK;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> data_seg()</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">ThreadProc</span><span class="params">(LPVOID lParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Thread start\n&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Thread stop\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;main start\n&quot;</span>);</span><br><span class="line">hThread=CreateThread(<span class="literal">NULL</span>,<span class="number">0</span>,ThreadProc,<span class="literal">NULL</span>,<span class="number">0</span>,<span class="literal">NULL</span>);</span><br><span class="line">WaitForSingleObject(hThread, <span class="number">1</span>);</span><br><span class="line">CloseHandle(hThread);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;main stop\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对以上代码的解释：</p><ul><li><p><code>#pragma comment(linker,&quot;/INCLUDE:__tls_used&quot;)</code>作用是告知编译器使用 TLS 回调函数。其中，在 x86 环境下，使用<code>__tls_used</code>，而在x64环境下使用<code>_tls_used</code></p></li><li><p><code> TLS_CALLBACK</code>这个函数即是我们定义的 TLS 回调函数，遵照上面的函数定义即可。</p></li><li><p><code>#pragma data_seg(&quot;.CRT$XLY&quot;)</code>和<code>#pragma data_seg()</code>作用是注册回调函数，如果回调函数只有 1 个，则可以以上述形式编写代码即可，如果回调函数有多个，则可以声明一个数组，如<code>PIMAGE_TLS_CALLBACK tls_callback_func[] = &#123;TLS_CALLBACK1, TLS_CALLBACK2, 0&#125;;</code>注意数组最后一个元素必须为 0 。<code>WaitForSingleObject</code>这个函数作用是等待线程运行，否则 main 进程会先于 ThreadProc 线程结束，有可能 ThreadProc 线程还未运行，进程就结束了，运行结果就不太清晰</p></li><li><p>如果编译选项中开启了 /MT ，则 TLS 中的 printf 函数可能会出现错误，此时可以使用如下代码来防止出现问题：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> <span class="built_in">string</span>[<span class="number">80</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">wsprintfA(<span class="built_in">string</span>,<span class="string">&quot;TLStest,reason=%d\n&quot;</span>,Reason);</span><br><span class="line">HANDLE hStdout = GetStdHandle(STD_OUTPUT_HANDLE);</span><br><span class="line">WriteConsoleA(hStdout, <span class="built_in">string</span>, <span class="built_in">strlen</span>(<span class="built_in">string</span>), <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure></li><li><p>运行结果如下，可以看出其 Reason 对应的各种情况：</p><p><img src="/pictures/TLS%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C.jpg" alt="运行结果"></p><h2 id="如何调试-TLS-回调函数"><a href="#如何调试-TLS-回调函数" class="headerlink" title="如何调试 TLS 回调函数"></a>如何调试 TLS 回调函数</h2><p>直接使用调试器打开带 TLS 回调函数的程序，则无法调试 TLS 回调函数，因为 TLS 早在 EP 代码开始前就被执行了，因此需要在调试器中打开<code>System breakpoint</code>选项，从而使程序暂停在系统启动断点<code>System Startup Breakpoint</code>处。有的调试器也提供”暂停在 TLS 回调函数处”的选项。</p></li></ul>]]></content>
    
    
    <summary type="html">关于 TLS 回调函数的分析和应用</summary>
    
    
    
    <category term="《逆向工程核心原理》笔记" scheme="https://4nsw3r.top/categories/%E3%80%8A%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="CTF-RE" scheme="https://4nsw3r.top/tags/CTF-RE/"/>
    
    <category term="TLS" scheme="https://4nsw3r.top/tags/TLS/"/>
    
  </entry>
  
  <entry>
    <title>googleCTF RE-CPP解题思路</title>
    <link href="https://4nsw3r.top/2021/07/21/theSecond/"/>
    <id>https://4nsw3r.top/2021/07/21/theSecond/</id>
    <published>2021-07-21T10:29:32.175Z</published>
    <updated>2021-07-22T07:46:04.930Z</updated>
    
    <content type="html"><![CDATA[<p><code>__INCLUDE_LEVEL__</code>表示包含深度，和<code>#include&quot;cpp.c&quot;</code>构成递归，这个递归用处不大，只是在一次次根据S的值执行不同代码，可以不管他<br>通过对每个<code>#if</code>分析可得知每个块的功能<br><code>S</code>相当于<code>loc</code>，然后对<code>R</code>、<code>Z</code>、<code>X</code>等等做运算，根据结果进行跳转到不同<code>S</code><br>得到主要逻辑：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">I = <span class="number">0</span>;</span><br><span class="line">M = <span class="number">0</span>;</span><br><span class="line">N = <span class="number">1</span>;</span><br><span class="line">P = <span class="number">0</span>;</span><br><span class="line">Q = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">B = <span class="number">0xE5</span>;<span class="comment">//1110 0101</span></span><br><span class="line">B = B + I;</span><br><span class="line"><span class="keyword">if</span> (B == <span class="number">0</span>) <span class="keyword">break</span>;<span class="comment">//if(Q==0) success</span></span><br><span class="line">B = <span class="number">0x80</span>;<span class="comment">//1000 0000</span></span><br><span class="line">B = B + I;</span><br><span class="line">L = B;</span><br><span class="line">A = RAM[B];</span><br><span class="line">L = I; B = RAM[I];</span><br><span class="line">R = <span class="number">1</span>;</span><br><span class="line">X = <span class="number">1</span>;</span><br><span class="line">Y = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (X == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">Z = X;</span><br><span class="line">Z = Z &amp; B;</span><br><span class="line"><span class="keyword">if</span> (Z != <span class="number">0</span>)</span><br><span class="line">Y = Y + A;</span><br><span class="line">X = X + X;</span><br><span class="line">A = A + A;</span><br><span class="line">&#125;</span><br><span class="line">A = Y;</span><br><span class="line"></span><br><span class="line">R = ~R;</span><br><span class="line">Z = <span class="number">1</span>;</span><br><span class="line">R += Z;</span><br><span class="line">R += Z;</span><br><span class="line"></span><br><span class="line">O = M;</span><br><span class="line">O += N;</span><br><span class="line">M = N;</span><br><span class="line">N = O;</span><br><span class="line">A += M;</span><br><span class="line">B = <span class="number">0x20</span>;<span class="comment">//0010 0000</span></span><br><span class="line">B += I;</span><br><span class="line">L = B; C = RAM[L];</span><br><span class="line">A = A ^ C;</span><br><span class="line">P = P + A;</span><br><span class="line">B = <span class="number">0x40</span>;<span class="comment">//0100 0000</span></span><br><span class="line">B = B + I;</span><br><span class="line">L = B; A = RAM[L];</span><br><span class="line">A = A ^ P;</span><br><span class="line">Q |= A;</span><br><span class="line">I += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由前面的宏定义知flag长度为26，并且在上面的主要逻辑中可以看到flag是一位一位验证的，因此可以直接暴力跑。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> RAM0[][<span class="number">8</span>] = &#123; &#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125; &#125;;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> RAM[<span class="number">0xFF</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">91</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">RAM[i] = RAM0[i][<span class="number">7</span>] * <span class="number">128</span> + RAM0[i][<span class="number">6</span>] * <span class="number">64</span> + RAM0[i][<span class="number">5</span>] * <span class="number">32</span> + RAM0[i][<span class="number">4</span>] * <span class="number">16</span> + RAM0[i][<span class="number">3</span>] * <span class="number">8</span> + RAM0[i][<span class="number">2</span>] * <span class="number">4</span> + RAM0[i][<span class="number">1</span>] * <span class="number">2</span> + RAM0[i][<span class="number">0</span>] * <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> A, B, C, I, L, M, N, O, P, X, Y, Z, Q, R;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> a, b, c, i, l, m, n, o, p, x, y, z, q, r;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">a = A;</span><br><span class="line">b = B;</span><br><span class="line">c = C;</span><br><span class="line">i = I;</span><br><span class="line">l = L;</span><br><span class="line">m = M;</span><br><span class="line">n = N;</span><br><span class="line">o = O;</span><br><span class="line">p = P;</span><br><span class="line">x = X;</span><br><span class="line">y = Y;</span><br><span class="line">z = Z;</span><br><span class="line">q = Q;</span><br><span class="line">r = R;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">A = a;</span><br><span class="line">B = b;</span><br><span class="line">C = c;</span><br><span class="line">I = i;</span><br><span class="line">L = l;</span><br><span class="line">M = m;</span><br><span class="line">N = n;</span><br><span class="line">O = o;</span><br><span class="line">P = p;</span><br><span class="line">X = x;</span><br><span class="line">Y = y;</span><br><span class="line">Z = z;</span><br><span class="line">Q = q;</span><br><span class="line">R = r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">change();</span><br><span class="line">I = <span class="number">0</span>;</span><br><span class="line">M = <span class="number">0</span>;</span><br><span class="line">N = <span class="number">1</span>;</span><br><span class="line">P = <span class="number">0</span>;</span><br><span class="line">Q = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">B = <span class="number">0xE5</span>;<span class="comment">//1110 0101</span></span><br><span class="line">B = B + I;</span><br><span class="line"><span class="keyword">if</span> (B == <span class="number">0</span>) <span class="keyword">break</span>;<span class="comment">//if(Q==0) success</span></span><br><span class="line">B = <span class="number">0x80</span>;<span class="comment">//1000 0000</span></span><br><span class="line">B = B + I;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">48</span>; j &lt; <span class="number">127</span>; j++)</span><br><span class="line">&#123;</span><br><span class="line">push();</span><br><span class="line">L = B; </span><br><span class="line">A = j;</span><br><span class="line">L = I; B = RAM[I];</span><br><span class="line">R = <span class="number">1</span>;</span><br><span class="line">X = <span class="number">1</span>;</span><br><span class="line">Y = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (X == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">Z = X;</span><br><span class="line">Z = Z &amp; B;</span><br><span class="line"><span class="keyword">if</span> (Z != <span class="number">0</span>)</span><br><span class="line">Y = Y + A;</span><br><span class="line">X = X + X;</span><br><span class="line">A = A + A;</span><br><span class="line">&#125;</span><br><span class="line">A = Y;</span><br><span class="line"></span><br><span class="line">R = ~R;</span><br><span class="line">Z = <span class="number">1</span>;</span><br><span class="line">R += Z;</span><br><span class="line">R += Z;</span><br><span class="line"></span><br><span class="line">O = M;</span><br><span class="line">O += N;</span><br><span class="line">M = N;</span><br><span class="line">N = O;</span><br><span class="line">A += M;</span><br><span class="line">B = <span class="number">0x20</span>;<span class="comment">//0010 0000</span></span><br><span class="line">B += I;</span><br><span class="line">L = B; C = RAM[L];</span><br><span class="line">A = A ^ C;</span><br><span class="line">P = P + A;</span><br><span class="line">B = <span class="number">0x40</span>;<span class="comment">//0100 0000</span></span><br><span class="line">B = B + I;</span><br><span class="line">L = B; A = RAM[L];</span><br><span class="line">A = A ^ P;</span><br><span class="line">Q |= A;</span><br><span class="line"><span class="keyword">if</span> (Q == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">putchar</span>(j);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">pop();</span><br><span class="line">&#125;</span><br><span class="line">I += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>即可得flag：<code>CTF&#123;pr3pr0cess0r_pr0fe5sor&#125;</code></p>]]></content>
    
    
    <summary type="html">googleCTF2021的逆向题CPP解题思路</summary>
    
    
    
    <category term="虚拟机逆向" scheme="https://4nsw3r.top/categories/%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%80%86%E5%90%91/"/>
    
    
    <category term="CTF-RE" scheme="https://4nsw3r.top/tags/CTF-RE/"/>
    
    <category term="宏逆向" scheme="https://4nsw3r.top/tags/%E5%AE%8F%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://4nsw3r.top/2021/07/21/hello-world/"/>
    <id>https://4nsw3r.top/2021/07/21/hello-world/</id>
    <published>2021-07-21T05:22:51.693Z</published>
    <updated>2021-07-21T10:58:18.566Z</updated>
    
    <content type="html"><![CDATA[<p>I’m 4nsw3r. Welcome to my Blog!</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;I’m 4nsw3r. Welcome to my Blog!&lt;/p&gt;
</summary>
      
    
    
    
    
    <category term="Introduction" scheme="https://4nsw3r.top/tags/Introduction/"/>
    
  </entry>
  
</feed>
